<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –æ—Ç –• –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ ‚Äî –ø–æ–¥–±–µ—Ä–∏—Ç–µ –ø–æ—Ä—Ç—Ñ–µ–ª—å –ø–æ–¥ –≤–∞—à –ø—Ä–æ—Ñ–∏–ª—å —Ä–∏—Å–∫–∞.">
  <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä ‚Äî –• –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css" />
</text></svg>">
</head>
<body>

  <!-- Header -->
  <header class="header">
    <div class="container">
      <div class="logo">–• –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏</div>
      <nav class="nav" id="mainNav">
        <a href="index.html#smart-money" class="nav-link">Smart Money</a>
        <a href="index.html#algo-trading" class="nav-link">Algo trading</a>
        <a href="index.html#crypto" class="nav-link">Crypto</a>
        <a href="index.html#about" class="nav-link">–û –Ω–∞—Å</a>
        <a href="index.html" class="nav-link">–ì–ª–∞–≤–Ω–∞—è</a>
      </nav>
      <button class="burger" id="burgerBtn" aria-label="–ú–µ–Ω—é">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </header>

  <!-- Disclaimer Banner -->
  <div class="disclaimer-banner">
    ‚ö†Ô∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–π –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–æ–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–µ–π (–ò–†) –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ–º –†–§.
  </div>

  <!-- Progress Bar -->
  <div class="progress-container">
    <div class="progress-bar" id="progressBar">
      <div class="progress-step active" data-step="1">1</div>
      <div class="progress-step" data-step="2">2</div>
      <div class="progress-step" data-step="3">3</div>
      <div class="progress-step" data-step="4">4</div>
    </div>
    <div class="progress-label" id="progressLabel">–®–∞–≥ 1 –∏–∑ 4</div>
  </div>

  <!-- Main Content -->
  <main class="calculator-container">
    <div class="step" id="step-profile" data-step="1">
      <h2>–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ—Ñ–∏–ª—å —Ä–∏—Å–∫–∞</h2>
      <p>–ü—Ä–æ—Å—Ç–æ –∏–∑–≤–ª–µ–∫–∏—Ç–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –≤—ã–≥–æ–¥—É –∏–∑ —Å–≤–æ–∏—Ö –∞–∫—Ç–∏–≤–æ–≤ ‚Äî —Å –ø–æ–º–æ—â—å—é –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π, –Ω–∏–∑–∫–∏—Ö –∑–∞—Ç—Ä–∞—Ç –∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏.</p>
      <div class="profile-cards">
        <div class="profile-card" data-profile="conservative">
          <h3>–ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π</h3>
          <p>–ú–∏–Ω–∏–º—É–º —Ä–∏—Å–∫–∞, —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –¥–æ—Ö–æ–¥</p>
        </div>
        <div class="profile-card" data-profile="balanced">
          <h3>–°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π</h3>
          <p>–£–º–µ—Ä–µ–Ω–Ω—ã–π —Ä–∏—Å–∫, —Ä–æ—Å—Ç + –¥–æ—Ö–æ–¥</p>
        </div>
        <div class="profile-card" data-profile="aggressive">
          <h3>–ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π</h3>
          <p>–ú–∞–∫—Å–∏–º—É–º —Ä–æ—Å—Ç–∞, –≤—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫</p>
        </div>
      </div>
      <button class="btn-next" disabled>–î–∞–ª–µ–µ</button>
    </div>

    <div class="step hidden" id="step-management" data-step="2">
      <h2>–¢–∏–ø —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h2>
      <p>–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥—Ö–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –≤–∞–º –±–ª–∏–∂–µ: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–ª–∏ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–µ.</p>
      <div class="toggle-group">
        <label class="toggle-option active" data-type="passive">
          <input type="radio" name="management" value="passive" checked>
          <span>–ü–∞—Å—Å–∏–≤–Ω–æ–µ</span>
        </label>
        <label class="toggle-option" data-type="active">
          <input type="radio" name="management" value="active">
          <span>–ê–∫—Ç–∏–≤–Ω–æ–µ</span>
        </label>
      </div>
      <button class="btn-prev">–ù–∞–∑–∞–¥</button>
      <button class="btn-next">–î–∞–ª–µ–µ</button>
    </div>

    <div class="step hidden" id="step-allocation" data-step="3">
      <h2>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–∞–ø–∏—Ç–∞–ª–∞</h2>
      <p>–°—É–º–º–∞ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π: <strong>1 000 000 ‚ÇΩ</strong></p>
      <div class="allocation-inputs">
          <div class="alloc-item">
              <label>–ê–∫—Ü–∏–∏ (%)</label>
              <input type="number" min="0" max="100" value="0" id="alloc-stocks">
          </div>
          <div class="alloc-item">
              <label>–û–±–ª–∏–≥–∞—Ü–∏–∏ (%)</label>
              <input type="number" min="0" max="100" value="0" id="alloc-bonds">
          </div>
          <div class="alloc-item">
              <label>ETF (%)</label>
              <input type="number" min="0" max="100" value="0" id="alloc-etf">
          </div>
          <div class="alloc-item">
              <label>–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞ (%)</label>
              <input type="number" min="0" max="100" value="0" id="alloc-crypto">
          </div>
          <div class="alloc-item">
              <label>–§—å—é—á–µ—Ä—Å—ã (%)</label>
              <input type="number" min="0" max="100" value="0" id="alloc-futs">
          </div>
      </div>
      <div class="allocation-summary">
        <p>–¢–µ–∫—É—â–∞—è —Å—É–º–º–∞: <span id="alloc-sum">0%</span> (<span id="alloc-remaining">100%</span> –¥–æ 100%)</p>
      </div>
      <button class="btn-prev">–ù–∞–∑–∞–¥</button>
      <button class="btn-next" id="btn-submit">–ü–æ–ª—É—á–∏—Ç—å –ø–æ—Ä—Ç—Ñ–µ–ª—å</button>
    </div>

    <div class="step hidden result-step" id="step-result" data-step="4">
      <h2>–í–∞—à –±–∞–∑–æ–≤—ã–π –ø–æ—Ä—Ç—Ñ–µ–ª—å</h2>
      <p>–ù–∞ –æ—Å–Ω–æ–≤–µ –≤–∞—à–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è –∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π –º—ã —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–ª–∏ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ.</p>
      <div class="asset-cards">
        <div class="asset-card">
          <h3>–ê–∫—Ü–∏–∏</h3>
          <ul>
            <li>SBER</li>
            <li>GAZP</li>
            <li>AAPL</li>
          </ul>
        </div>
        <div class="asset-card">
          <h3>–û–±–ª–∏–≥–∞—Ü–∏–∏</h3>
          <ul>
            <li>–û–§–ó 26235</li>
            <li>–†–æ—Å–Ω–µ—Ñ—Ç—å BO-001P-01</li>
          </ul>
        </div>
        <div class="asset-card">
          <h3>ETF</h3>
          <ul>
            <li>FXRL</li>
            <li>SBMX</li>
          </ul>
        </div>
        <div class="asset-card">
          <h3>–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞</h3>
          <ul>
            <li>BTC</li>
            <li>ETH</li>
          </ul>
        </div>
      </div>
      <div class="report-actions">
        <button class="btn-download" id="btn-free-report">–°–∫–∞—á–∞—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç—á—ë—Ç</button>
      </div>
      <div class="premium-upsell">
        <h3>–•–æ—Ç–∏—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π PDF-–æ—Ç—á—ë—Ç?</h3>
        <p>–ü–æ–¥—Ä–æ–±–Ω—ã–π –∞–Ω–∞–ª–∏–∑, —Å—Ü–µ–Ω–∞—Ä–∏–∏, –Ω–∞–ª–æ–≥–æ–≤–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å ‚Äî –≤—Å–µ–≥–æ –∑–∞ <strong>290 ‚ÇΩ</strong></p>
        <button class="btn-premium" id="btn-premium">–ü–æ–ª—É—á–∏—Ç—å –∑–∞ 290 ‚ÇΩ</button>
      </div>
    </div>

    <div class="step hidden" id="step-premium-form">
      <h2>–ü–æ–ª—É—á–∏—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç—á—ë—Ç</h2>
      <p>–í–≤–µ–¥–∏—Ç–µ –≤–∞—à email, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å PDF-–æ—Ç—á—ë—Ç –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã.</p>
      <form id="premiumForm">
        <div class="form-group">
          <input type="email" id="email" required placeholder="–≤–∞—à@email.ru">
        </div>
        <div class="checkbox">
          <input type="checkbox" id="consent" required>
          <label for="consent">–°–æ–≥–ª–∞—Å–µ–Ω –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö</label>
        </div>
        <button type="submit" class="btn-pay">–û–ø–ª–∞—Ç–∏—Ç—å 290 ‚ÇΩ</button>
      </form>
      <button class="btn-prev">–ù–∞–∑–∞–¥</button>
    </div>
  </main>

  <footer class="footer">
    <div class="container">
      <div class="footer-bottom">
        <p>&copy; 2025 –• –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
      </div>
    </div>
  </footer>

  <button id="backToTop" class="back-to-top" aria-label="–ù–∞–≤–µ—Ä—Ö">‚Üë</button>

  <script>
      // === State ===
      const state = {
          currentStep: 1,
          profile: null,
          management: 'passive',
          allocation: { stocks: 0, bonds: 0, etf: 0, crypto: 0, futs: 0 }
      };

      // === DOM Elements ===
      const steps = document.querySelectorAll('.step');
      const progressBarSteps = document.querySelectorAll('.progress-step');
      const progressLabel = document.getElementById('progressLabel');
      const allocInputs = {
          stocks: document.getElementById('alloc-stocks'),
          bonds: document.getElementById('alloc-bonds'),
          etf: document.getElementById('alloc-etf'),
          crypto: document.getElementById('alloc-crypto'),
          futs: document.getElementById('alloc-futs')
      };

      // === Utils ===
      function goToStep(step) {
          if (step < 1 || step > 4) return;
          state.currentStep = step;
          steps.forEach(s => s.classList.add('hidden'));
          document.querySelector(`.step[data-step="${step}"]`).classList.remove('hidden');
          progressBarSteps.forEach((el, i) => el.classList.toggle('active', i + 1 <= step));
          progressLabel.textContent = `–®–∞–≥ ${step} –∏–∑ 4`;
      }

      function updateAllocation() {
          const sum = Object.values(allocInputs).reduce((acc, input) => acc + (parseFloat(input.value) || 0), 0);
          const remaining = 100 - sum;
          document.getElementById('alloc-sum').textContent = `${sum}%`;
          document.getElementById('alloc-remaining').textContent = `${Math.max(0, remaining)}%`;
          document.getElementById('btn-submit').disabled = sum !== 100;
          Object.keys(allocInputs).forEach(k => {
              state.allocation[k] = parseFloat(allocInputs[k].value) || 0;
          });
      }

      function parseSheetCSV(csv, sheetName) {
          const lines = csv.trim().split('\n');
          if (lines.length < 2) return [];
          return lines.slice(1).map(line => {
              const cols = line.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/).map(c => c.replace(/^"(.*)"$/, '$1').trim());
              return { ticker: cols[0] || '‚Äî', name: cols[1] || '‚Äî' };
          }).filter(i => i.ticker !== '‚Äî');
      }

      // === –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF –≤ –±—Ä–∞—É–∑–µ—Ä–µ (jsPDF + html2canvas –Ω–µ –Ω—É–∂–Ω—ã ‚Äî –ø—Ä–æ—Å—Ç–æ–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π PDF) ===
      function generatePDF(instruments) {
          const { profile, management, allocation } = state;

          const profileMap = {
              conservative: '–ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π',
              balanced: '–°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π',
              aggressive: '–ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π'
          };
          const managementMap = {
              passive: '–ü–∞—Å—Å–∏–≤–Ω–æ–µ',
              active: '–ê–∫—Ç–∏–≤–Ω–æ–µ'
          };

          const lines = [];
          lines.push('–• –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏');
          lines.push('');
          lines.push('–ò–ù–í–ï–°–¢–ò–¶–ò–û–ù–ù–´–ô –û–¢–ß–Å–¢ (–¥–µ–º–æ)');
          lines.push('============================');
          lines.push(`–ü—Ä–æ—Ñ–∏–ª—å: ${profileMap[profile] || '‚Äî'}`);
          lines.push(`–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: ${managementMap[management] || '‚Äî'}`);
          lines.push('');
          lines.push('–†–ê–°–ü–†–ï–î–ï–õ–ï–ù–ò–ï:');
          Object.entries(allocation).forEach(([k, v]) => {
              if (v > 0) {
                  const names = { stocks: '–ê–∫—Ü–∏–∏', bonds: '–û–±–ª–∏–≥–∞—Ü–∏–∏', etf: 'ETF', crypto: '–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞', futs: '–§—å—é—á–µ—Ä—Å—ã' };
                  lines.push(`‚Ä¢ ${names[k]}: ${v}%`);
              }
          });
          lines.push('');
          lines.push('–†–ï–ö–û–ú–ï–ù–î–£–ï–ú–´–ï –ò–ù–°–¢–†–£–ú–ï–ù–¢–´:');

          const sheetToName = {
              '–ê–∫—Ü–∏–∏': 'stocks',
              '–û–±–ª–∏–≥–∞—Ü–∏–∏': 'bonds',
              'ETF': 'etf',
              '–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞': 'crypto',
              '–§—å—é—á–µ—Ä—Å—ã': 'futs'
          };

          Object.entries(sheetToName).forEach(([sheet, key]) => {
              if (allocation[key] > 0 && instruments[sheet]?.length) {
                  lines.push('');
                  lines.push(`${sheet}:`);
                  instruments[sheet].slice(0, 3).forEach(t => lines.push(`  - ${t.ticker}`));
              }
          });

          lines.push('');
          lines.push('‚ö†Ô∏è –î–µ–º–æ-–æ—Ç—á—ë—Ç. –ù–µ —è–≤–ª—è–µ—Ç—Å—è –ò–†.');
          lines.push('üìû +7 (495) 123-45-67');
          lines.push('‚úâÔ∏è info@xinvest.ru');
          lines.push('üì≤ @xinvest (Telegram)');

          // –°–æ–∑–¥–∞—ë–º –ø—Ä–æ—Å—Ç–æ–π PDF —á–µ—Ä–µ–∑ data:URI (–±–µ–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫)
          const blob = new Blob([lines.join('\n')], { type: 'application/pdf' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `xinvest-report-${Date.now()}.pdf`;
          document.body.appendChild(a);
          a.click();
          setTimeout(() => {
              document.body.removeChild(a);
              URL.revokeObjectURL(url);
          }, 100);
      }

      // === –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è ===
      async function generateReport() {
          const sheetNames = ['stocks', 'bonds', 'etf', 'crypto', 'futs'];
          const instruments = {};

          for (const sheet of sheetNames) {
              try {
                  const url = `https://docs.google.com/spreadsheets/d/1mbDXTf4lK1nOFIO3UGdI9fvDJy4wp_2YJYYrc31umzQ/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(sheet)}`;
                  const res = await fetch(url);
                  const csv = await res.text();
                  instruments[sheet] = parseSheetCSV(csv, sheet);
              } catch (e) {
                  instruments[sheet] = [];
                  console.warn(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å ${sheet}`);
              }
          }

          generatePDF(instruments);
      }

      // === Event Listeners ===
      document.querySelectorAll('.profile-card').forEach(card => {
          card.addEventListener('click', () => {
              document.querySelectorAll('.profile-card').forEach(c => c.classList.remove('selected'));
              card.classList.add('selected');
              state.profile = card.dataset.profile;
              document.querySelector('.btn-next').disabled = false;
          });
      });

      document.querySelectorAll('.toggle-option').forEach(opt => {
          opt.addEventListener('click', () => {
              document.querySelectorAll('.toggle-option').forEach(o => o.classList.remove('active'));
              opt.classList.add('active');
              state.management = opt.dataset.type;
          });
      });

      Object.values(allocInputs).forEach(input => {
          input.addEventListener('input', () => {
              let val = parseFloat(input.value);
              if (isNaN(val) || val < 0) input.value = 0;
              if (val > 100) input.value = 100;
              updateAllocation();
          });
      });

      document.querySelectorAll('.btn-next').forEach(btn => {
          btn.addEventListener('click', () => {
              if (state.currentStep === 3) {
                  const sum = Object.values(state.allocation).reduce((a, b) => a + b, 0);
                  if (sum !== 100) return;
              }
              goToStep(state.currentStep + 1);
          });
      });

      document.querySelectorAll('.btn-prev').forEach(btn => {
          btn.addEventListener('click', () => goToStep(state.currentStep - 1));
      });

      // === üî• –ö–ù–û–ü–ö–ê –ü–†–ï–ú–ò–£–ú ‚Üí –ì–ï–ù–ï–†–ê–¶–ò–Ø PDF –°–†–ê–ó–£ ===
      document.getElementById('btn-premium')?.addEventListener('click', () => {
          if (!state.profile) {
              alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å');
              return;
          }
          generateReport();
      });

      // === Mobile menu & scroll ===
      const burger = document.getElementById('burgerBtn');
      const nav = document.getElementById('mainNav');
      burger?.addEventListener('click', () => {
          nav.classList.toggle('nav--active');
          burger.classList.toggle('burger--active');
      });
      document.querySelectorAll('.nav-link')?.forEach(link => {
          link.addEventListener('click', () => {
              nav.classList.remove('nav--active');
              burger?.classList.remove('burger--active');
          });
      });
      const backToTopBtn = document.getElementById('backToTop');
      window.addEventListener('scroll', () => {
          if (backToTopBtn) backToTopBtn.style.display = window.scrollY > 300 ? 'block' : 'none';
      });
      backToTopBtn?.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));

      // === Start ===
      goToStep(1);
  </script>
</body>
</html>